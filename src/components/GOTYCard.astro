---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Platform {
	name: string;
	played?: boolean;
}

interface GotyEntry {
	year: number;
	title: string;
	platforms: Platform[];
	genres: string[];
	release: string;
	blurb: string;
	slug: string;
	credit: string;
	image: ImageMetadata;
}

const { entry, eager = false } = Astro.props as { entry: GotyEntry; eager?: boolean };
---

<article class={`featured article goty year-${entry.year}`}>
	<div class="article-background">
		<Image
			src={entry.image}
			alt={`${entry.title} artwork`}
			width={1200}
			loading={eager ? 'eager' : 'lazy'}
			fetchpriority={eager ? 'high' : 'auto'}
		/>
	</div>
	<div class="article-overlay"></div>

	<div class={`ribbon year-${entry.year}`}>
		<span class="ribbon-text">{entry.year}</span>
	</div>

	<div class="article-content">
		<p class="article-label">My Game of the Year {entry.year}</p>
		<h2 class="article-title">{entry.title}</h2>

		<p class="article-meta">
			{
				entry.platforms.map((platform, i) => (
					<>
						<span class={platform.played ? 'my-platform' : undefined}>{platform.name}</span>
						{i < entry.platforms.length - 1 && <span class="platform-separator"> / </span>}
					</>
				))
			}
		</p>

		<p class="article-meta">{entry.genres.join(' · ')} · {entry.release}</p>
		<p class="article-blurb">{entry.blurb}</p>
		<a href={`/reviews/${entry.slug}`} class="read-more">Read More</a>
	</div>

	<p class="image-credit">{entry.credit}</p>
</article>

<style>
	.goty {
		position: relative;
		min-height: 430px;
		border-radius: 26px;
		overflow: hidden;
	}

	.article-background {
		position: absolute;
		inset: 0;
		z-index: 0;
	}

	.article-background :global(img) {
		width: 100%;
		height: 100%;
		object-fit: cover;
		border-radius: 0;
		display: block;
		transition: transform 0.35s ease;
		will-change: transform;
	}

	.goty:hover .article-background :global(img) {
		transform: scale(1.06);
	}

	.article-overlay {
		position: absolute;
		inset: 0;
		background:
			linear-gradient(180deg, rgba(0, 0, 0, 0.82) 10%, rgba(0, 0, 0, 0.48) 52%, rgba(0, 0, 0, 0.78) 100%);
		z-index: 1;
	}

	.article-content {
		position: relative;
		z-index: 2;
		padding: 2.25rem;
		margin-top: 0;
		color: #fff;
		display: flex;
		flex-direction: column;
		justify-content: flex-start;
		min-height: 430px;
	}

	.ribbon {
		position: absolute;
		top: 1.15rem;
		right: -3.3rem;
		z-index: 2;
		width: 13rem;
		padding: .70rem 0;
		transform: rotate(45deg);
		background: linear-gradient(145deg, #b89b3c 0%, #e5c76b 40%, #7a6525 100%);
		color: #fff;
		font-size: 1.65rem;
		font-weight: 700;
		line-height: 1;
		text-align: center;
	}

	.ribbon.year-2022 {
		background: linear-gradient(
			144deg,
			rgba(154, 0, 0, 1) 0%,
			rgba(154, 0, 0, 1) 22%,
			rgba(122, 42, 90, 1) 52%,
			rgba(0, 200, 255, 1) 82%,
			rgba(0, 200, 255, 1) 100%
		);
	}

	.ribbon.year-2023 {
		background: linear-gradient(224deg, #4a0a0a 20%, #b11212 55%, #7a0505 100%);
	}

	.ribbon.year-2024 {
		background: linear-gradient(135deg, #ffd700 0%, #f5c542 30%, #1c4d8d 70%, #133766 100%);
	}

	.ribbon.year-2025 {
		background: linear-gradient(145deg, #b89b3c 0%, #e5c76b 35%, #7a6525 55%, #0f0f0f 100%);
	}

	.ribbon-text {
		display: block;
		width: 100%;
		text-align: center;
		white-space: nowrap;
	}

	.article-label {
		margin: 0 0 0.35rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.06em;
		font-size: 1.6rem;
		opacity: 0.9;
	}

	.article-title {
		margin: 0 0 0.95rem;
		color: #fff;
		font-size: 2.45rem;
		line-height: 1.15;
	}

	.article-title::after {
		content: '';
		display: block;
		width: 78px;
		height: 4px;
		background: #d4af37;
		margin-top: 0.5rem;
		border-radius: 999px;
	}

	.article-meta {
		margin: 0 0 0.65rem;
		font-size: 1.05rem;
	}

	.article-blurb {
		margin: 0.7rem 0 1.15rem;
		font-size: 1.06rem;
		max-width: 58ch;
	}

	.my-platform {
		color: #ffd700;
		font-weight: 700;
	}

	.read-more {
		color: #fff;
		font-weight: 700;
		text-decoration: none;
		width: fit-content;
		border: 2px solid #fff;
		border-radius: 6px;
		padding: 0.3rem 1rem;
		transition: background 0.2s ease, color 0.2s ease;
	}

	.read-more:hover {
		background: #fff;
		color: #111;
	}

	.image-credit {
		position: absolute;
		left: 2.2rem;
		bottom: 1.1rem;
		margin: 0;
		z-index: 2;
		font-size: 0.82rem;
		font-style: italic;
		color: rgba(255, 255, 255, 0.9);
	}

	@media (max-width: 900px) {
		.article-content {
			padding: 1.5rem;
		}
	}
</style>
