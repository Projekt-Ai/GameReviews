---
const navLinks = [
	{ href: '/', label: 'Home', group: 'primary' },
	{ href: '/reviews', label: 'Reviews', group: 'primary' },
	{ href: '/bossfeatures', label: 'Boss Features', group: 'primary' },
	{ href: '/search', label: 'Search', group: 'primary' },
	{ href: '/about', label: 'About', group: 'primary' },
	{ href: '/news', label: 'News', group: 'secondary' },
	{ href: '/music-appreciation', label: 'Music Appreciation', group: 'secondary' },
	{ href: '/imexcited', label: "I'm Excited", group: 'secondary' },
];

const desktopLinks = navLinks.filter((link) => link.href !== '/');
const allMobileLinks = navLinks;

const currentPath = Astro.url.pathname.replace(/\/+$/, '') || '/';
const isActiveLink = (href: string) => {
	const normalizedHref = href.replace(/\/+$/, '') || '/';
	if (normalizedHref === '/') return currentPath === '/';
	return currentPath === normalizedHref || currentPath.startsWith(`${normalizedHref}/`);
};
---

<header class="site-header">
	<div class="header-main">
		<a class="logo" href="/">KAT</a>

		<div class="header-center">
			<a class="brand" href="/">A Kat's Kronicles</a>

			<nav class="nav" aria-label="Main navigation">
				<div class="nav-inner">
					{
						desktopLinks.map((link) => (
							<a href={link.href} class:list={{ 'is-active': isActiveLink(link.href) }}>
								{link.label}
							</a>
						))
					}
				</div>
			</nav>
		</div>

		<div class="header-actions">
			<div class="header-search">
				<form role="search" action="/search/" method="get">
					<div class="search-field">
						<span class="search-icon" aria-hidden="true">
							<svg viewBox="0 0 24 24" fill="none">
								<circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"></circle>
								<path d="M20 20L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
							</svg>
						</span>
						<input type="text" name="q" placeholder="Search" aria-label="Search Game Reviews" />
					</div>
				</form>
			</div>

			<button class="mobile-menu-toggle" aria-label="Open menu" aria-expanded="false">
				<svg class="icon-hamburger" viewBox="0 0 24 24" fill="none" width="22" height="22">
					<path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
				</svg>
				<svg class="icon-close" viewBox="0 0 24 24" fill="none" width="22" height="22">
					<path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
				</svg>
			</button>
		</div>
	</div>
</header>

<!-- Mobile side panel -->
<div class="mobile-overlay" aria-hidden="true"></div>
<nav class="mobile-panel" aria-label="Mobile navigation" aria-hidden="true">
	<div class="mobile-panel-links">
		{
			allMobileLinks.map((link) => (
				<a href={link.href} class:list={{ 'is-active': isActiveLink(link.href) }}>
					{link.label}
				</a>
			))
		}
	</div>
</nav>

<script is:inline>
	(() => {
		const toggle = document.querySelector('.mobile-menu-toggle');
		const overlay = document.querySelector('.mobile-overlay');
		const panel = document.querySelector('.mobile-panel');

		function openMenu() {
			panel.classList.add('is-open');
			overlay.classList.add('is-open');
			toggle.setAttribute('aria-expanded', 'true');
			panel.setAttribute('aria-hidden', 'false');
			document.body.style.overflow = 'hidden';
		}

		function closeMenu() {
			panel.classList.remove('is-open');
			overlay.classList.remove('is-open');
			toggle.setAttribute('aria-expanded', 'false');
			panel.setAttribute('aria-hidden', 'true');
			document.body.style.overflow = '';
		}

		toggle.addEventListener('click', function () {
			var isOpen = panel.classList.contains('is-open');
			isOpen ? closeMenu() : openMenu();
		});

		overlay.addEventListener('click', closeMenu);

		document.addEventListener('keydown', function (e) {
			if (e.key === 'Escape') closeMenu();
		});
	})();
</script>
